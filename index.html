<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ultra-Minimal Trading Game</title>
    <style>
        * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #0d1117;
  color: white;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  overflow: hidden;
  height: 100vh;
  width: 100vw;
  position: fixed;
  touch-action: none;
}

.app-container {
  width: 100%;
  height: 100%;
  position: relative;
  display: flex;
  flex-direction: column;
}

.hud {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 20px;
  z-index: 10;
  background: rgba(13, 17, 23, 0.9);
  backdrop-filter: blur(10px);
  gap: 20px;
}

.hud-button {
  background: rgba(150, 255, 44, 0.7);
  border: none;
  color: rgb(0, 0, 0);
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  font-weight: 600;
  min-width: 80px;
  transition: background 0.2s;
}

.hud-button.left {
  position: absolute;
  left: 20px;
}

.hud-button.right {
  position: absolute;
  right: 20px;
}

.hud-button:hover {
  background: rgba(150, 255, 44, 0.9);
}

.hud-button:active {
  transform: scale(0.98);
}

.stake-container {
  display: flex;
  align-items: center;
  gap: 8px;
}

.market-section {
  display: flex;
  align-items: center;
  gap: 6px;
}

.market-label {
  color: #ffffff;
  font-size: 12px;
  font-weight: 600;
}

.pair-label {
  background: #161b22;
  border: 1px solid #30363d;
  color: white;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
}
.market-dropdown {
  background: #161b22;
  border: 1px solid #30363d;
  color: white;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  outline: none;
}

.market-dropdown:hover {
  border-color: rgba(150, 255, 44, 0.9);
}

.crypto-logo {
  width: 20px;
  height: 20px;
}

.trade-size-section {
  display: flex;
  align-items: center;
  gap: 6px;
}

.trade-label {
  color: #ffffff;
  font-size: 12px;
  font-weight: 500;
}

.dollar-sign {
  color: white;
  font-size: 16px;
  font-weight: 600;
}
.stake-input {
  background: #161b22;
  border: 1px solid #30363d;
  color: white;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 16px;
  width: 80px;
  text-align: center;
  font-weight: 600;
}

.stake-input:focus {
  outline: none;
  border-color: rgba(150, 255, 44, 0.9);
}

.player-info {
  position: absolute;
  top: 60px;
  left: 0;
  right: 0;
  text-align: center;
  font-size: 12px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  background: rgba(13, 17, 23, 0.8);
  backdrop-filter: blur(10px);
}

.player-count-container {
  display: flex;
  align-items: center;
  gap: 6px;
  color: white;
}

.player-icon {
  font-size: 16px;
}

.balance-hud {
  color: rgba(150, 255, 44, 0.7);
  font-weight: 600;
}

.game-container {
  position: absolute;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 375px;
  height: 400px;
  z-index: 5;
}

.game-canvas {
  width: 100%;
  height: 100%;
  cursor: pointer;
  border-radius: 8px;
  overflow: hidden;
}

.balance-badge {
  position: absolute;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(150, 255, 44, 0.7);
  padding: 10px 20px;
  border-radius: 20px;
  font-size: 16px;
  font-weight: 600;
  z-index: 10;
  box-shadow: 0 4px 12px rgba(35, 134, 54, 0.3);
}

.launch-screen {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: #0d1117;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 20;
}

.launch-button {
  background: rgba(150, 255, 44, 0.7);
  border: none;
  color: rgb(0, 0, 0);
  padding: 20px 40px;
  border-radius: 12px;
  font-size: 20px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 8px 24px rgba(35, 134, 54, 0.3);
}

.launch-button:hover {
  background: rgba(150, 255, 44, 0.9);
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(35, 134, 54, 0.4);
}

.launch-button:active {
  transform: translateY(0);
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 30;
  backdrop-filter: blur(10px);
}

.modal-content {
  background: #0d1117;
  border: 1px solid #30363d;
  border-radius: 16px;
  padding: 24px;
  width: 90%;
  max-width: 350px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
}

.modal-header {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 20px;
  text-align: center;
  color: white;
}

.qr-container {
  display: flex;
  justify-content: center;
  margin: 24px 0;
}

.qr-placeholder {
  width: 200px;
  height: 200px;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #0d1117;
  font-size: 14px;
  text-align: center;
  border-radius: 12px;
  font-weight: 600;
}

.close-modal {
  background: #30363d;
  border: none;
  color: white;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  width: 100%;
  margin-top: 16px;
  font-size: 16px;
  font-weight: 600;
  transition: background 0.2s;
}

.close-modal:hover {
  background: #484f58;
}

/* ========== BET BOX CLEAN LAYOUT ========== */
.bet-box {
  position: absolute;
  min-width: 75px;
  background: rgba(255, 255, 255, 0.95);
  color: #0d1117;
  font-size: 11px;
  font-weight: 700;
  border-radius: 6px;
  pointer-events: none;
  text-align: center;
  z-index: 8;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  padding: 4px 6px;
  line-height: 1.2;
}

.bet-box.win {
  background: rgba(150, 255, 44, 0.8);
  color: #0d1117;
  animation: winPulse 0.5s ease-out;
}

.bet-box.lose {
  background: rgba(249, 72, 170, 0.8);
  color: #0d1117;
  animation: losePulse 0.5s ease-out;
}

.bet-inner {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.bet-inner .top-row {
  display: flex;
  align-items: center;
  gap: 4px;
}

.bet-inner .bet-type {
  font-size: 14px;
}

.bet-inner .bet-stake {
  font-size: 12px;
  font-weight: 700;
}

.bet-inner .bet-entry {
  font-size: 10px;
  opacity: 0.8;
  margin-top: 1px;
}

.bet-inner .bet-timer {
  font-size: 10px;
  font-weight: 800;
  margin-top: 2px;
  background: rgba(0, 0, 0, 0.05);
  padding: 2px 4px;
  border-radius: 4px;
}

.bet-box.win .bet-timer {
  background: rgba(35, 120, 33, 0.12);
}

.bet-box.lose .bet-timer {
  background: rgba(180, 30, 80, 0.12);
}

@keyframes winPulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
  }
}

@keyframes losePulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(0.8);
  }
  100% {
    transform: scale(1);
  }
}

/* Toast notifications */
.toast {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 24px;
  border-radius: 8px;
  color: rgb(0, 0, 0);
  font-size: 14px;
  font-weight: 600;
  z-index: 25;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  animation: toastSlideUp 0.3s ease-out;
  min-width: 150px;
  text-align: center;
}

.toast.win {
  background: rgba(150, 255, 44, 0.9);
}

.toast.lose {
  background: rgba(249, 72, 170, 0.9);
}

@keyframes toastSlideUp {
  from {
    transform: translateX(-50%) translateY(100px);
    opacity: 0;
  }
  to {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }
}

.hidden {
  display: none !important;
}

/* Price tags that ride the mid-line */
.price-tag {
  position: absolute;
  background: rgba(32, 31, 31, 0.9);
  color: white;
  font-size: 13px;
  font-weight: 750;
  padding: 2px 6px;
  border-radius: 3px;
  border: 1px solid #30363d;
  z-index: 6;
  pointer-events: none;
  transition: color 0.3s ease;
}

.price-tag.left {
  left: 5px;
}

.price-tag.right {
  right: 5px;
}

/* Prevent text selection on mobile */
* {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

input {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

/* Player Leaderboard Box */
.leaderboard-box {
  position: absolute;
  left: 20px;
  top: 300px;
  transform: translateY(-50%);
  width: 200px;
  height: 400px;
  background: linear-gradient(
    135deg,
    rgba(35, 134, 54, 0.1) 0%,
    rgba(13, 17, 23, 0.95) 50%
  );
  border: 1px solid #30363d;
  border-radius: 12px;
  backdrop-filter: blur(10px);
  z-index: 9;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
}

.leaderboard-header {
  background: rgba(0, 0, 0, 1);
  padding: 12px;
  text-align: center;
  border-bottom: 1px solid #30363d;
  font-weight: 600;
  font-size: 14px;
  color: rgba(150, 255, 44, 0.9);
  position: sticky;
  top: 0;
  z-index: 10;
  backdrop-filter: blur(10px);
}

.leaderboard-content {
  height: calc(100% - 45px);
  overflow-y: auto;
  overflow-x: hidden;
  padding: 8px;
  animation: smoothScroll 40s linear infinite;
  position: relative;
}

.leaderboard-content:hover {
  animation-play-state: paused;
}

@keyframes smoothScroll {
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-50%);
  }
}

.player-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  margin-bottom: 6px;
  background: rgba(22, 27, 34, 0.6);
  border-radius: 8px;
  border: 1px solid rgba(48, 54, 61, 0.5);
}

.player-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.player-info-text {
  flex: 1;
  min-width: 0;
}

.player-name {
  font-size: 12px;
  font-weight: 600;
  color: white;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.player-stats {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 2px;
}

.player-time {
  font-size: 10px;
  color: #8b949e;
}

.player-winrate {
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 4px;
  font-weight: 600;
}

.player-winrate.high {
  background: rgba(34, 197, 94, 0.2);
  color: #22c55e;
}

.player-winrate.medium {
  background: rgba(234, 179, 8, 0.2);
  color: #eab308;
}

.player-winrate.low {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
}

/* Price Scale - Left Side */
.price-scale {
  position: absolute;
  left: 48.5%;
  top: 199px;
  width: 85px;
  height: 397px;
  margin-left: -267px;
  background: rgba(13, 17, 23, 0.95);
  border-right: 3px solid #30363d;
  z-index: 7;
  overflow: hidden;
  transform: translateY(-50%);
}

.price-scale-inner {
  position: relative;
  width: 100%;
  height: 400px;
  transition: transform 0.1s linear;
}

.price-tick {
  position: absolute;
  right: 5px;
  font-size: 10px;
  color: #8b949e;
  font-weight: 600;
  white-space: nowrap;
  padding: 2px 4px;
}

.price-tick.major {
  color: white;
  font-size: 11px;
}

.price-tick-line {
  position: absolute;
  left: 77px !important;
  width: 5px;
  height: 1px;
  background: #6e6f70;
}

.price-tick-line.major {
  width: 8px;
  left: 75px !important;
  background: #6e6f70;
}

/* Center Button */
.center-button {
  position: absolute;
  left: 50%;
  bottom: auto;
  top: 390px;
  width: 35px;
  height: 35px;
  margin-left: -237px;
  background: rgba(150, 255, 44, 0.7);
  border: none;
  border-radius: 6px;
  color: rgb(0, 0, 0);
  font-size: 16px;
  font-weight: bolder;
  cursor: pointer;
  z-index: 8;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(35, 134, 54, 0.3);
  transition: all 0.2s;
}

.center-button:hover {
  background: rgba(150, 255, 44, 0.9);
  transform: scale(1.05);
}

.center-button:active {
  transform: scale(0.95);
}

/* Scrollbar styling */
.leaderboard-content::-webkit-scrollbar {
  width: 4px;
}

.leaderboard-content::-webkit-scrollbar-track {
  background: rgba(22, 27, 34, 0.3);
}

.leaderboard-content::-webkit-scrollbar-thumb {
  background: #30363d;
  border-radius: 2px;
}

.leaderboard-content::-webkit-scrollbar-thumb:hover {
  background: #484f58;
}

/* =========  MOBILE  ≤ 768 px  ========= */

@media (max-width: 768px) {
  /* Prevent accidental highlights */
  * {
    -webkit-tap-highlight-color: transparent;
  }

  /* ==== 1. HUD (Top Bar) ==== */
  .hud {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: 55px !important;
    padding: 6px 6px !important;
    display: flex !important;
    align-items: center !important;
    gap: 5px !important;
    z-index: 100 !important;
    background: rgba(13, 17, 23, 0.96) !important;
    backdrop-filter: blur(10px) !important;
    flex-wrap: nowrap !important;
    flex-direction: row !important;
    justify-content: flex-start !important;
  }

  .hud-button {
    position: static !important;
    font-size: 9px !important;
    padding: 6px 8px !important;
    border-radius: 6px !important;
    min-width: 60px !important;
    flex-shrink: 0 !important;
  }

  /* ==== 2. Market + Trade Size ==== */
  .stake-container {
    flex: 1 !important;
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    justify-content: flex-start !important;
    gap: 4px !important;
    flex-wrap: nowrap !important;
  }

  .market-section,
  .trade-size-section {
    display: flex !important;
    align-items: center !important;
    gap: 4px !important;
    flex-shrink: 0 !important;
  }

  .market-label,
  .trade-label {
    font-size: 9px !important;
    color: #ffffff !important;
    white-space: nowrap !important;
  }

  .crypto-logo {
    width: 16px !important;
    height: 16px !important;
    flex-shrink: 1 !important;
  }

  .market-dropdown {
    background: #161b22 !important;
    border: 1px solid #30363d !important;
    color: white !important;
    border-radius: 6px !important;
    padding: 5px 8px !important;
    font-size: 9px !important;
    min-width: 70px !important;
  }
  /* === Make both dropdowns (Market + Time) look identical === */
  #marketDropdown,
  #timeframeDropdown {
    appearance: none !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    background: #161b22
      url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath fill='white' d='M0 0l5 6 5-6z'/%3E%3C/svg%3E")
      no-repeat right 10px center !important;
    background-size: 10px 6px !important;
    border: 1px solid #30363d !important;
    color: white !important;
    padding: 5px 25px 5px 8px !important;
    border-radius: 6px !important;
    font-size: 9px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    outline: none !important;
    min-width: 80px !important;
    text-align-last: center !important;
    transition: border-color 0.2s !important;
  }
  #marketDropdown:hover,
  #timeframeDropdown:hover {
    border-color: rgba(150, 255, 44, 0.9) !important;
  }

  .stake-input {
    background: #161b22 !important;
    border: 1px solid #30363d !important;
    color: white !important;
    width: 60px !important;
    font-size: 9px !important;
    text-align: center !important;
    padding: 5px 6px !important;
    border-radius: 6px !important;
  }

  .dollar-sign {
    font-size: 12px !important;
    color: white !important;
  }

  /* ==== 3. Player Info Bar ==== */
  .player-info {
    position: fixed !important;
    top: 55px !important;
    left: 0 !important;
    right: 0 !important;
    height: 25px !important;
    font-size: 10px !important;
    z-index: 90 !important;
    background: rgba(13, 17, 23, 0.85) !important;
  }

  .balance-hud {
    font-size: 10px !important;
    color: rgba(150, 255, 44, 0.7);
  }

  /* ==== 4. Game Area ==== */
  .game-container {
    position: fixed !important;
    top: 60px !important;
    left: 90px !important;
    width: 80vw !important;
    transform: none !important;
    padding: 0 !important;
    z-index: 5 !important;
    display: flex;
    align-items: center;
    height: 550px !important;
  }

  .game-canvas {
    width: 90% !important;
    height: 100% !important;
    border-radius: 0 !important;
  }

  /* ==== 5. Price Scale (Left Edge) ==== */
  .price-scale {
    left: -61px !important;
    top: 117px !important;
    width: 60px !important;
    height: 317px !important;
    margin: 0 !important;
    transform: none !important;
    background: rgba(13, 17, 23, 0.95) !important;
    border-right: 1px solid #30363d !important;
    z-index: 7 !important;
  }

  .price-tick {
    font-size: 8px !important;
    right: 3px !important;
  }

  .price-tick.major {
    font-size: 9px !important;
  }

  .price-tick-line {
    position: absolute;
    left: 54px !important;
    width: 5px;
    height: 1px;
    background: #6e6f70;
  }

  .price-tick-line.major {
    width: 8px;
    left: 55px !important;
    background: #6e6f70;
  }
  /* ==== 6. Price Tags ==== */
  .price-tag {
    position: absolute;
    background: rgba(32, 31, 31, 0.9);
    color: white;
    font-size: 13px;
    font-weight: 750;
    padding: 2px 6px;
    border-radius: 3px;
    border: 1px solid #30363d;
    z-index: 6;
    pointer-events: none;
    transition: color 0.3s ease;
  }

  .price-tag.left {
    left: 5px;
  }

  .price-tag.right {
    right: 5px;
  }

  /* ==== 7. Center Button ==== */
  .center-button {
    position: absolute !important;
    top: 410px;
    left: -35px !important;
    bottom: 0px !important;
    width: 32px !important;
    height: 32px !important;
    font-size: 14px !important;
    margin: 0 !important;
    z-index: 8 !important;
  }

  /* ==== 8. Leaderboard (Bottom Drawer) ==== */
  .leaderboard-box {
    position: fixed !important;
    left: 0 !important;
    right: 500px !important;
    bottom: 0 !important;
    top: 650px !important;
    width: 100vw !important;
    height: 160px !important;
    border-radius: 12px 12px 0 0 !important;
    z-index: 200 !important;
    background: rgba(13, 17, 23, 0.98) !important;
    border-top: 1px solid #30363d !important;
    box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.4) !important;
    display: block !important;
  }

  .leaderboard-header {
    padding: 10px !important;
    font-size: 12px !important;
    height: 40px !important;
    text-align: center !important;
    color: rgba(150, 255, 44, 0.7) !important;
    background: rgba(0, 0, 0, 0.8) !important;
    border-bottom: 1px solid #30363d !important;
  }

  .leaderboard-content {
    height: calc(100% - 40px) !important;
    overflow-y: auto !important;
    animation: none !important;
    padding: 6px !important;
  }

  /* ==== 9. Toasts & Bet Boxes ==== */
  .toast {
    bottom: 170px !important;
    font-size: 12px !important;
    z-index: 999 !important;
  }

  .bet-box {
    width: 60px !important;
    height: 28px !important;
    font-size: 10px !important;
  }

  /* ==== 10. Prevent Scrolling ==== */
  body,
  html,
  .app-container {
    overflow: hidden !important;
  }

  /* Hide floating balance badge */
  .balance-badge {
    display: none !important;
  }
}

    </style>
    </head>
        <body>
            <div id="app">
                <div class="launch-screen" id="launchScreen">
                    <button class="launch-button" id="launchButton">Launch Game</button>
                </div>
                
                <div class="app-container hidden" id="gameApp">
                   
                    <div class="hud">
                    <button class="hud-button left" id="withdrawBtn">🏦 Withdraw</button>
                    <div class="stake-container">
                    
                    <div class="market-section">
                    <span class="market-label">Market:</span>
                    <svg class="crypto-logo" id="cryptoLogo" width="20" height="20" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.927 23.959l-9.823-5.797 9.817 13.839 9.828-13.839-9.828 5.797zM16.073 0l-9.819 16.297 9.819 5.807 9.823-5.801z" fill="#8A92B2"/>
                    </svg>
                    <select class="market-dropdown" id="marketDropdown">
                        <option value="SOL">SOL/USDC</option>
                        <option value="ETH" selected>ETH/USDC</option>
                        <option value="BTC">BTC/USDC</option>
                    </select>
                </div>

                <div class="trade-size-section">
                    <span class="trade-label">Trade size:</span>
                    <input 
                        type="number" 
                        class="stake-input" 
                        id="stakeInput"
                        value="5.00"
                        min="5"
                        step="0.1"
                    >
                    <span class="dollar-sign">$</span>

                    <span class="trade-label">Time:</span>
                    <select class="market-dropdown" id="timeframeDropdown">
                        <option value="10s" selected>10 sec</option>
                        <option value="30s">30 sec</option>
                        <option value="1m">01 min</option>
                        <option value="5m">05 min</option>
                        <option value="10m">10 min</option>
                        <option value="30m">30 min</option>
                        <option value="1h">01 hour</option>
                    </select>
                </div>
      
                <button class="hud-button right" id="depositBtn">💰 Deposit</button>
            </div>
                    
                    <div class="player-info" id="playerInfo">
                                <div class="player-count-container">
                    <span class="player-icon">👥</span>
                    <span id="playerCount">12 players online</span>
                </div>
                        <span class="balance-hud" id="balanceHud">Balance: 42.30 USDC</span>
                    </div>
 
                    <!-- Player Leaderboard -->
                    <div class="leaderboard-box">
                        <div class="leaderboard-header">👥 LIVE PLAYERS</div>
                        <div class="leaderboard-content" id="leaderboardContent">
                            <!-- Players will be added here dynamically -->
                        </div>
                    </div>

                    <div class="game-container">
                        
                    <!-- Price Scale - Left Side -->
                <div class="price-scale">
                    <div class="price-scale-inner" id="priceScaleInner">
                        <!-- Ticks will be added dynamically -->
                    </div>
                </div>

                <!-- Center Button -->
                <button class="center-button" id="centerButton" title="Center Mid-line">⊙</button>
                   
                    <svg
                        class="game-canvas"
                        id="gameCanvas"
                        viewBox="0 0 375 400"
                        width="375"
                        height="400"
                        >               
                <!-- Main area background (dark) -->
                <rect x="0" y="0" width="315" height="400" fill="#0D1117" />

                <!-- Finish zone area (grey) -->
                <rect x="315" y="0" width="60" height="400" fill="#2A2A2A" />

                <!-- Dynamic green bar -->
                <rect id="greenBar" x="0" y="170" width="315" height="30" fill="#96FF2C" opacity="0.7" />

                <!-- Dynamic red bar -->
                <rect id="redBar" x="0" y="202" width="315" height="30" fill="#f948aa" opacity="0.7" />

                <!-- White mid-line -->
                <line id="midLine" x1="0" y1="200" x2="375" y2="200" stroke="white" stroke-width="2" />

                <!-- Finish line -->
                <g id="checkeredLine">
                    <rect x="313" y="0" width="5" height="20" fill="black"/>
                    <rect x="313" y="20" width="5" height="20" fill="white"/>
                    <rect x="313" y="40" width="5" height="20" fill="black"/>
                    <rect x="313" y="60" width="5" height="20" fill="white"/>
                    <rect x="313" y="80" width="5" height="20" fill="black"/>
                    <rect x="313" y="100" width="5" height="20" fill="white"/>
                    <rect x="313" y="120" width="5" height="20" fill="black"/>
                    <rect x="313" y="140" width="5" height="20" fill="white"/>
                    <rect x="313" y="160" width="5" height="20" fill="black"/>
                    <rect x="313" y="180" width="5" height="20" fill="white"/>
                    <rect x="313" y="200" width="5" height="20" fill="black"/>
                    <rect x="313" y="220" width="5" height="20" fill="white"/>
                    <rect x="313" y="240" width="5" height="20" fill="black"/>
                    <rect x="313" y="260" width="5" height="20" fill="white"/>
                    <rect x="313" y="280" width="5" height="20" fill="black"/>
                    <rect x="313" y="300" width="5" height="20" fill="white"/>
                    <rect x="313" y="320" width="5" height="20" fill="black"/>
                    <rect x="313" y="340" width="5" height="20" fill="white"/>
                    <rect x="313" y="360" width="5" height="20" fill="black"/>
                    <rect x="313" y="380" width="5" height="20" fill="white"/>
                </g>

                <!-- TOP horizontal shadow -->
                <line id="topShadow" x1="0" y1="170" x2="375" y2="170" stroke="#000" stroke-width="1" opacity="0.25" filter="url(#softBlur)" />

                <!-- LEFT vertical shadow -->
                <line id="leftShadow" x1="5" y1="0" x2="5" y2="400" stroke="#000" stroke-width="3" opacity="0.18" filter="url(#softBlur)" />

                <!-- Soft-blur filter -->
                <defs>
                    <filter id="softBlur" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur in="SourceGraphic" stdDeviation="2" />
                    </filter>
                </defs>
                </svg>
                
                <!-- Price tags that ride the mid-line -->
                <div class="price-tag left" id="leftPriceTag">$2,500.00</div>
                <div class="price-tag right" id="rightPriceTag">$2,500.00</div>
            </div>
            
        </div>
        
        <!-- Deposit Modal -->
        <div class="modal hidden" id="depositModal">
            <div class="modal-content">
                <div class="modal-header">Deposit USDC</div>
                <div class="qr-container">
                    <div class="qr-placeholder">
                        QR Code<br><br>
                        solana:4zMMC9...<br><br>
                        Amount: <span id="depositAmount">2.50</span> USDC
                    </div>
                </div>
                <button class="close-modal" id="closeDeposit">Close</button>
            </div>
        </div>
        
        <!-- Withdraw Modal -->
        <div class="modal hidden" id="withdrawModal">
            <div class="modal-content">
                <div class="modal-header">Withdraw USDC</div>
                <div class="qr-container">
                    <div class="qr-placeholder">
                        QR Code<br><br>
                        Withdraw <span id="withdrawAmount">2.50</span> USDC<br><br>
                        Scan with Phantom
                    </div>
                </div>
                <button class="close-modal" id="closeWithdraw">Close</button>
            </div>
        </div>
        
        <!-- Toast container -->
        <div id="toastContainer"></div>
    </div>
    <script>
        // ===== REAL-TIME PYTH FEEDS =====
const FEEDS = {
  ETH: "0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace",
  SOL: "0xef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d",
  BTC: "0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43",
};

// ===== TIMEFRAME SPEED MAP =====
const TIMEFRAMES = {
  "1s": 1,
  "10s": 10,
  "30s": 30,
  "1m": 60,
  "5m": 300,
  "10m": 600,
  "30m": 1800,
  "1h": 3600,
};
class TradingGame {
  constructor() {
    this.priceUpdateInterval = null;
    this.displayUpdateInterval = null;
    this.launched = false;
    this.balance = 42.3;
    this.stake = 5;
    this.currentTimeframe = "10s";
    this.boxes = [];
    this.currentMarket = "ETH";
    this.currentPrice = 2500.0;
    this.scaleCenterPrice = this.currentPrice;
    this.pixelsPerPrice = 2;
    this.scaleHeight = 400;
    this.tickPx = 40;
    this.playerCount = 12;
    this.animationTime = 0;
    this.midLineY = 200;
    this.gameLoopId = null;
    this.toastContainer = null;
    this.lastScaleUpdate = 0; // Debounce scale updates
    this.pendingBalanceUpdates = []; // Queue balance updates

    this.initializeElements();
    this.bindEvents();
    this.startMockUpdates();
    this.initializePlayers();
    // --- draw initial scale ticks once ---
    this.pixelsPerPrice = this.getPricePerPixel();
    this.drawTicks();
  }

  initializeElements() {
    this.launchScreen = document.getElementById("launchScreen");
    this.gameApp = document.getElementById("gameApp");
    this.launchButton = document.getElementById("launchButton");
    this.gameCanvas = document.getElementById("gameCanvas");
    this.greenBar = document.getElementById("greenBar");
    this.redBar = document.getElementById("redBar");
    this.midLine = document.getElementById("midLine");
    this.stakeInput = document.getElementById("stakeInput");
    this.balanceHud = document.getElementById("balanceHud");
    this.playerCountDisplay = document.getElementById("playerCount");
    this.leftPriceTag = document.getElementById("leftPriceTag");
    this.rightPriceTag = document.getElementById("rightPriceTag");
    this.toastContainer = document.getElementById("toastContainer");
    this.marketDropdown = document.getElementById("marketDropdown");
    this.cryptoLogo = document.getElementById("cryptoLogo");
    this.priceScaleInner = document.getElementById("priceScaleInner");
    this.centerButton = document.getElementById("centerButton");
    this.timeframeDropdown = document.getElementById("timeframeDropdown");

    // Modal elements
    this.depositModal = document.getElementById("depositModal");
    this.withdrawModal = document.getElementById("withdrawModal");
    this.depositBtn = document.getElementById("depositBtn");
    this.withdrawBtn = document.getElementById("withdrawBtn");
    this.closeDeposit = document.getElementById("closeDeposit");
    this.closeWithdraw = document.getElementById("closeWithdraw");
    this.depositAmount = document.getElementById("depositAmount");
    this.withdrawAmount = document.getElementById("withdrawAmount");
  }

  bindEvents() {
    this.launchButton.addEventListener("click", () => this.launchGame());
    this.gameCanvas.addEventListener("click", (e) => this.handleCanvasClick(e));
    this.stakeInput.addEventListener("change", (e) => this.updateStake(e));
    this.marketDropdown.addEventListener("change", (e) =>
      this.changeMarket(e.target.value)
    );
    this.centerButton.addEventListener("click", () => this.centerMidLine());
    this.timeframeDropdown.addEventListener("change", (e) => {
      this.currentTimeframe = e.target.value;
      console.log("Timeframe changed to:", this.currentTimeframe);
    });

    // Modal events
    this.depositBtn.addEventListener("click", () => this.showDepositModal());
    this.withdrawBtn.addEventListener("click", () => this.showWithdrawModal());
    this.closeDeposit.addEventListener("click", () => this.hideDepositModal());
    this.closeWithdraw.addEventListener("click", () =>
      this.hideWithdrawModal()
    );

    // Close modals on background click
    this.depositModal.addEventListener("click", (e) => {
      if (e.target === this.depositModal) this.hideDepositModal();
    });
    this.withdrawModal.addEventListener("click", (e) => {
      if (e.target === this.withdrawModal) this.hideWithdrawModal();
    });
  }
  cleanup() {
    // Cancel animation loop
    if (this.gameLoopId) {
      cancelAnimationFrame(this.gameLoopId);
    }

    // Clear intervals
    if (this.priceUpdateInterval) clearInterval(this.priceUpdateInterval);
    if (this.displayUpdateInterval) clearInterval(this.displayUpdateInterval);

    // Remove all bet boxes
    this.boxes.forEach((box) => {
      if (box.element && box.element.parentNode) {
        box.element.remove();
      }
    });
  }

  launchGame() {
    this.launched = true;
    this.launchScreen.classList.add("hidden");
    this.gameApp.classList.remove("hidden");
    this.startAnimation();
  }

  startAnimation() {
    const animate = () => {
      this.animationTime += 1;

      // micro-sensitive price → screen Y  (160-240 px)
      // ---------- SINGLE SMOOTH CALCULATION ----------
      const centerY = 200;
      this.pixelsPerPrice = this.getPricePerPixel();

      const priceOffset = this.currentPrice - this.scaleCenterPrice;
      const pixelOffset = priceOffset * this.pixelsPerPrice;

      // Smooth interpolation to prevent jitter (0.3 = smoothness factor)
      const targetY = centerY - pixelOffset;
      const distance = Math.abs(targetY - this.midLineY);
      const smoothing = distance > 50 ? 0.5 : 0.3; // Faster for large gaps
      this.midLineY += (targetY - this.midLineY) * smoothing;
      this.midLineY = Math.max(0, Math.min(400, this.midLineY));

      // dynamic bars update
      const greenH = Math.max(0, this.midLineY);
      const redH = Math.max(0, 400 - this.midLineY);

      this.greenBar.setAttribute("y", 0);
      this.greenBar.setAttribute("height", greenH);
      this.redBar.setAttribute("y", this.midLineY);
      this.redBar.setAttribute("height", redH);
      // update white mid-line
      this.midLine.setAttribute("y1", this.midLineY);
      this.midLine.setAttribute("y2", this.midLineY);

      // keep shadows glued to the band
      document
        .getElementById("topShadow")
        .setAttribute("y1", this.midLineY - 30);
      document
        .getElementById("topShadow")
        .setAttribute("y2", this.midLineY - 30);
      // Update price tags position
      this.leftPriceTag.style.top = this.midLineY - 8 + "px";
      this.rightPriceTag.style.top = this.midLineY - 8 + "px";

      // Update box positions
      this.updateBoxes();
      this.updatePriceScale();
      this.gameLoopId = requestAnimationFrame(animate);
      /* inside the animate() loop, right after you compute this.midLineY */
      document.documentElement.style.setProperty("--midY", this.midLineY);
    };

    animate();
  }

  handleCanvasClick(e) {
    if (!this.launched) return;
    const rect = this.gameCanvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    // Scale coordinates to SVG viewBox
    const scaleX = 375 / rect.width;
    const scaleY = 400 / rect.height;
    const svgX = x * scaleX;
    const svgY = y * scaleY;

    // Green area: 0 to midLineY, Red area: midLineY to 400
    const isInGreenArea = svgY < this.midLineY;
    const isInRedArea = svgY > this.midLineY;

    // Check if click is before finish line
    if (svgX >= 0 && svgX <= 315) {
      if (isInGreenArea) {
        this.placeBet(svgX, svgY, "long");
      } else if (isInRedArea) {
        this.placeBet(svgX, svgY, "short");
      }
    }
  }

  placeBet(x, y, side) {
    const timeframeInSeconds = TIMEFRAMES[this.currentTimeframe] || 60;
    const now = Date.now();
    const box = {
      id: Date.now() + Math.random(),
      x: 0,
      y: y - 10,
      stake: this.stake,
      side: side, // 'long' or 'short'
      entryPrice: this.currentPrice, // Store current price at entry
      timeframe: this.currentTimeframe,
      duration: timeframeInSeconds,
      startTime: now, // store start time (new)
      endTime: now + timeframeInSeconds * 1000, // end timestamp (new)
      settled: false,
      element: null,
    };

    this.createBoxElement(box);
    this.boxes.push(box);
  }

  createBoxElement(box) {
    const boxElement = document.createElement("div");
    boxElement.className = "bet-box";
    boxElement.style.left = box.x + "px";
    boxElement.style.top = box.y + "px";

    // Show trade type

    boxElement.innerHTML = `
  <div class="bet-inner">
    <div class="top-row">
      <span class="bet-type">${box.side === "long" ? "📈" : "📉"}</span>
      <span class="bet-stake">$${box.stake.toFixed(2)}</span>
    </div>
    <div class="bet-entry">${box.entryPrice.toFixed(4)}</div>
    <div class="bet-timer" data-boxid="${box.id}">${formatRemaining(
      box.duration
    )}</div>
  </div>
`;

    // helper to format seconds -> "10s" or "01:30"
    function formatRemaining(sec) {
      if (sec >= 60) {
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
      } else {
        return `${Math.ceil(sec)}s`;
      }
    }

    // store format helper on element for later updates
    boxElement._formatRemaining = formatRemaining;

    // Position relative to game container
    const gameContainer = document.querySelector(".game-container");
    gameContainer.appendChild(boxElement);

    box.element = boxElement;
  }

  updateBoxes() {
    for (let i = 0; i < this.boxes.length; i++) {
      const box = this.boxes[i];

      if (!box.settled) {
        // ✅ Dynamic movement based on timeframe
        const totalDistance = 250;
        const timeframeInSeconds = TIMEFRAMES[box.timeframe] || 60;

        const pixelsPerSecond = totalDistance / timeframeInSeconds;
        // Use time-based speed instead of frame-based
        if (!box.startTime) box.startTime = Date.now();
        const elapsed = (Date.now() - box.startTime) / 1000;
        const distanceTraveled = elapsed * pixelsPerSecond;

        // Ease-out quad for smoother finish

        box.x = Math.min(distanceTraveled, totalDistance);

        if (box.element) {
          box.element.style.left = box.x + "px";

          // Update timer text (remaining)
          const now = Date.now();
          const remainingMs = Math.max(
            0,
            (box.endTime || box.startTime + timeframeInSeconds * 1000) - now
          );
          const remainingSec = Math.ceil(remainingMs / 1000);

          // format: mm:ss if >=60s else "XXs"
          let formatted;
          if (remainingSec >= 60) {
            const m = Math.floor(remainingSec / 60);
            const s = remainingSec % 60;
            formatted = `${String(m).padStart(2, "0")}:${String(s).padStart(
              2,
              "0"
            )}`;
          } else {
            formatted = `${remainingSec}s`;
          }

          const timerEl = box.element.querySelector(".bet-timer");
          if (timerEl) timerEl.textContent = formatted;
        }

        // Check if box reached finish line
        if (
          box.x >= 250 ||
          Date.now() >=
            (box.endTime || box.startTime + timeframeInSeconds * 1000)
        ) {
          box.settled = true;

          // Calculate profit/loss based on mid-line movement
          let won = false;
          if (box.side === "long") {
            won = this.currentPrice > box.entryPrice;
          } else if (box.side === "short") {
            won = this.currentPrice < box.entryPrice;
          }

          if (box.element) {
            box.element.classList.add(won ? "win" : "lose");
            // set timer to 0 / done
            const timerEl = box.element.querySelector(".bet-timer");
            if (timerEl) timerEl.textContent = "0s";
          }

          // Update balance immediately to prevent race conditions
          const stakeAmount = box.stake;
          const isWin = won;

          if (isWin) {
            this.balance += stakeAmount;
            this.showToast("CREDITED", "+" + stakeAmount.toFixed(2), true);
          } else {
            this.balance -= stakeAmount;
            this.showToast("DEBITED", "-" + stakeAmount.toFixed(2), false);
          }
          this.updateBalanceDisplay();

          // Remove box after animation
          setTimeout(() => {
            if (box.element && box.element.parentNode) {
              box.element.remove();
            }
          }, 1000);

          // Mark for removal
          this.boxes.splice(i, 1);
          i--;
        }
      }
    }
  }

  updatePriceScale() {
    const now = Date.now();
    if (now - this.lastScaleUpdate < 200) return; // Debounce 200ms

    const centerY = this.scaleHeight / 2;
    const priceOffset = this.currentPrice - this.scaleCenterPrice;
    const pixelOffset = priceOffset * this.pixelsPerPrice;

    const thresholdPx = this.scaleHeight / 2.5;
    if (Math.abs(pixelOffset) > thresholdPx) {
      this.scaleCenterPrice = this.currentPrice;
      this.drawTicks();
      this.lastScaleUpdate = now; // Update timestamp
    }
  }

  drawTicks() {
    const inner = this.priceScaleInner;
    inner.innerHTML = "";

    const stepPx = this.tickPx;
    const stepPrice = stepPx / this.pixelsPerPrice;
    const ticksEachSide = Math.ceil(this.scaleHeight / stepPx) + 2;
    const centerY = this.scaleHeight / 2;

    for (let i = -ticksEachSide; i <= ticksEachSide; i++) {
      const y = centerY - i * stepPx;
      const price = this.scaleCenterPrice + i * stepPrice;

      const line = document.createElement("div");
      line.className = `price-tick-line ${i % 2 === 0 ? "major" : ""}`;
      line.style.position = "absolute";
      line.style.left = "0";
      line.style.right = "0";
      line.style.height = "1px";
      line.style.top = `${y}px`;
      inner.appendChild(line);

      const lab = document.createElement("div");
      lab.className = `price-tick ${i % 2 === 0 ? "major" : ""}`;
      lab.style.position = "absolute";
      lab.style.left = "6px";
      lab.style.top = `${y - 8}px`;
      lab.textContent = price.toFixed(4);
      inner.appendChild(lab);
    }
  }

  getPricePerPixel() {
    // Different zoom levels for different markets
    const zooms = {
      ETH: 9,
      SOL: 9,
      BTC: 3,
    };
    return zooms[this.currentMarket] || 1;
  }

  centerMidLine() {
    const gameHeight = 400;
    const targetY = gameHeight / 2;
    const currentY = this.midLineY;
    const duration = 400;
    const startTime = Date.now();

    const glide = () => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const ease = 1 - Math.pow(1 - progress, 3);

      this.midLineY = currentY + (targetY - currentY) * ease;

      this.midLine.setAttribute("y1", this.midLineY);
      this.midLine.setAttribute("y2", this.midLineY);
      this.greenBar.setAttribute("height", Math.max(0, this.midLineY));
      this.redBar.setAttribute("y", this.midLineY);
      this.redBar.setAttribute("height", Math.max(0, 400 - this.midLineY));

      document
        .getElementById("topShadow")
        .setAttribute("y1", this.midLineY - 30);
      document
        .getElementById("topShadow")
        .setAttribute("y2", this.midLineY - 30);

      if (progress < 1) requestAnimationFrame(glide);
      else {
        this.scaleCenterPrice = this.currentPrice;
        this.drawTicks();
      }
    };
    glide();
  }

  updateStake(e) {
    const value = parseFloat(e.target.value) || 0.5;
    this.stake = Math.max(5, value);
    e.target.value = this.stake.toFixed(1);
  }

  updateBalanceDisplay() {
    this.balanceHud.textContent =
      "Balance: " + this.balance.toFixed(2) + " USDC";
  }

  showToast(title, amount, isWin) {
    // Limit max toasts to 3
    const existingToasts = this.toastContainer.querySelectorAll(".toast");
    if (existingToasts.length >= 3) {
      existingToasts[0].remove();
    }
    const toast = document.createElement("div");
    toast.className = `toast ${isWin ? "win" : "lose"}`;
    toast.textContent = `${title} ${amount}`;

    this.toastContainer.appendChild(toast);

    // Remove toast after 3 seconds
    setTimeout(() => {
      toast.style.animation = "toastSlideUp 0.3s ease-out reverse";
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, 3000);
  }

  showDepositModal() {
    this.depositAmount.textContent = this.stake.toFixed(2);
    this.depositModal.classList.remove("hidden");
  }

  hideDepositModal() {
    this.depositModal.classList.add("hidden");
  }

  showWithdrawModal() {
    this.withdrawAmount.textContent = this.stake.toFixed(2);
    this.withdrawModal.classList.remove("hidden");
  }

  hideWithdrawModal() {
    this.withdrawModal.classList.add("hidden");
  }

  changeMarket(market) {
    // --- Clear existing boxes on market switch ---
    this.boxes.forEach((box) => {
      if (box.element && box.element.parentNode) {
        box.element.remove();
      }
    });
    this.boxes = [];

    // --- 1️⃣ market switch setup ---
    this.currentMarket = market;
    this.scaleCenterPrice = this.currentPrice;
    this.pixelsPerPrice = this.getPricePerPixel();
    this.drawTicks();

    // --- 2️⃣ logo update block (same as pehle tha) ---
    if (market === "SOL") {
      this.cryptoLogo.setAttribute("viewBox", "0 0 397.7 311.7");
      this.cryptoLogo.innerHTML =
        '<defs><linearGradient id="solGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00FFA3;stop-opacity:1" /><stop offset="100%" style="stop-color:#DC1FFF;stop-opacity:1" /></linearGradient></defs><path fill="url(#solGradient)" d="M64.6 237.9c2.4-2.4 5.7-3.8 9.2-3.8h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1l62.7-62.7z"/><path fill="url(#solGradient)" d="M64.6 3.8C67.1 1.4 70.4 0 73.8 0h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1L64.6 3.8z"/><path fill="url(#solGradient)" d="M333.1 120.1c-2.4-2.4-5.7-3.8-9.2-3.8H6.5c-5.8 0-8.7 7-4.6 11.1l62.7 62.7c2.4 2.4 5.7 3.8 9.2 3.8h317.4c5.8 0 8.7-7 4.6-11.1l-62.7-62.7z"/>';
    } else if (market === "ETH") {
      this.cryptoLogo.setAttribute("viewBox", "0 0 32 32");
      this.cryptoLogo.innerHTML =
        '<path d="M15.927 23.959l-9.823-5.797 9.817 13.839 9.828-13.839-9.828 5.797zM16.073 0l-9.819 16.297 9.819 5.807 9.823-5.801z" fill="#8A92B2"/>';
    } else if (market === "BTC") {
      this.cryptoLogo.setAttribute("viewBox", "0 0 32 32");
      this.cryptoLogo.innerHTML =
        '<circle cx="16" cy="16" r="16" fill="#f7931a"/><path d="M21.03 13.44c.26-1.77-1.09-2.72-2.94-3.36l.6-2.42-1.47-.36-.58 2.34c-.38-.09-.77-.18-1.16-.26l.59-2.37-1.47-.36-.6 2.43c-.31-.07-.62-.15-.92-.23l.01-.03-2.03-.5-.39 1.54s1.09.25 1.06.27c.59.15.69.53.67.83l-.67 2.7c.04.01.08.02.13.03l-.13-.03-.94 3.78c-.07.17-.24.42-.63.33.01.02-1.06-.27-1.06-.27l-.73 1.68 1.92.48c.36.09.71.19 1.05.28l-.61 2.47 1.47.36.6-2.43c.4.11.8.21 1.18.31l-.6 2.42 1.47.36.61-2.46c2.5.47 4.38.28 5.17-1.98.64-1.81-.03-2.86-1.35-3.55.96-.22 1.68-.86 1.87-2.17Zm-3.36 4.74c-.45 1.81-3.48.83-4.47.59l.8-3.21c.99.25 4.14.75 3.67 2.62Zm.45-4.76c-.41 1.66-2.93.82-3.75.61l.72-2.9c.82.21 3.46.6 3.03 2.29Z" fill="white"/>';
    }

    // --- 3️⃣ base price set karo (placeholder) ---
    const basePrices = { SOL: 150, ETH: 2500, BTC: 65000 };
    this.currentPrice = basePrices[market];

    // --- 4️⃣ restart live updates for new market ---
    this.startMockUpdates();

    // --- 5️⃣ 🆕 immediate fetch add karo (new line) ---
    this.fetchRealPrice(this.currentMarket);
  }

  async fetchRealPrice(market) {
    try {
      const id = FEEDS[market];
      const url = `https://hermes.pyth.network/api/latest_price_feeds?ids[]=${id}`;
      const res = await fetch(url);
      const data = await res.json();
      const p = data[0].price;
      const price = Number(p.price) * Math.pow(10, Number(p.expo));
      if (this.currentMarket === market) this.currentPrice = price;
      return price;
    } catch (e) {
      console.warn("Pyth fetch failed", e);
      return this.currentPrice;
    }
  }

  startMockUpdates() {
    // stop any previous intervals
    if (this.priceUpdateInterval) clearInterval(this.priceUpdateInterval);
    if (this.displayUpdateInterval) clearInterval(this.displayUpdateInterval);

    let displayedPrice = this.currentPrice;

    this.priceUpdateInterval = setInterval(() => {
      const marketNow = this.currentMarket;
      this.fetchRealPrice(marketNow).catch(() => {});
    }, 400);

    this.displayUpdateInterval = setInterval(() => {
      const oldDisplayPrice = displayedPrice;
      const targetPrice = this.currentPrice;
      const diff = targetPrice - displayedPrice;
      displayedPrice += diff * 0.2;

      this.leftPriceTag.textContent = "$" + displayedPrice.toFixed(4);
      this.rightPriceTag.textContent = "$" + displayedPrice.toFixed(4);

      if (displayedPrice > oldDisplayPrice) {
        this.leftPriceTag.style.color = "#96FF2C";
        this.rightPriceTag.style.color = "#96FF2C";
      } else if (displayedPrice < oldDisplayPrice) {
        this.leftPriceTag.style.color = "#f948aa";
        this.rightPriceTag.style.color = "#f948aa";
      } else {
        this.leftPriceTag.style.color = "white";
        this.rightPriceTag.style.color = "white";
      }
    }, 50);

    // Mock player count updates
    setInterval(() => {
      this.playerCount = Math.max(
        1,
        this.playerCount + Math.floor(Math.random() * 3) - 1
      );
      this.playerCountDisplay.textContent =
        this.playerCount + " players online";
    }, 2000);
  }

  initializePlayers() {
    this.players = [];
    this.leaderboardContent = document.getElementById("leaderboardContent");

    // Player name templates
    const names = [
      "Crypto King",
      "Moon Walker",
      "Diamond Hands",
      "Whale Hunter",
      "Degen Trader",
      "Bull Master",
      "Bear Slayer",
      "Profit Ninja",
      "Leverage Lord",
      "Chart Wizard",
      "Pump Chaser",
      "Bag Holder",
      "HODL Hero",
      "Swing Master",
      "Day Trader",
      "Scalp God",
    ];

    // Emoji avatars with gradient backgrounds
    const avatars = [
      { emoji: "🚀", bg: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)" },
      { emoji: "💎", bg: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)" },
      { emoji: "🐋", bg: "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)" },
      { emoji: "🔥", bg: "linear-gradient(135deg, #fa709a 0%, #fee140 100%)" },
      { emoji: "⚡", bg: "linear-gradient(135deg, #30cfd0 0%, #330867 100%)" },
      { emoji: "🎯", bg: "linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)" },
      { emoji: "👑", bg: "linear-gradient(135deg, #ffd89b 0%, #19547b 100%)" },
      { emoji: "🦅", bg: "linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)" },
      { emoji: "🌟", bg: "linear-gradient(135deg, #fddb92 0%, #d1fdff 100%)" },
      { emoji: "💰", bg: "linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)" },
    ];

    // Generate 10 initial players
    for (let i = 0; i < 10; i++) {
      const name = names[Math.floor(Math.random() * names.length)];
      const avatar = avatars[Math.floor(Math.random() * avatars.length)];
      const winRate = Math.floor(Math.random() * 60) + 30; // 30-90%
      const joinTime = new Date(Date.now() - Math.random() * 3600000); // Random time in last hour

      this.players.push({
        id: Date.now() + i,
        name: name,
        avatar: avatar,
        winRate: winRate,
        joinTime: joinTime,
      });
    }

    // Render initial players
    this.renderPlayers();

    // Duplicate content for infinite scroll effect
    setTimeout(() => {
      const children = Array.from(this.leaderboardContent.children);
      children.forEach((child) => {
        const clone = child.cloneNode(true);
        this.leaderboardContent.appendChild(clone);
      });
    }, 100);

    // Add new players periodically
    setInterval(() => {
      this.addRandomPlayer();
    }, 8000);
  }

  renderPlayers() {
    this.leaderboardContent.innerHTML = "";

    this.players.forEach((player) => {
      const playerEl = this.createPlayerElement(player);
      this.leaderboardContent.appendChild(playerEl);
    });
  }

  createPlayerElement(player) {
    const div = document.createElement("div");
    div.className = "player-item";

    const timeDiff = Math.floor((Date.now() - player.joinTime) / 60000); // minutes ago
    const timeText = timeDiff < 1 ? "Just now" : `${timeDiff}m ago`;

    let winRateClass = "low";
    if (player.winRate >= 70) winRateClass = "high";
    else if (player.winRate >= 50) winRateClass = "medium";

    div.innerHTML = `
                        <div class="player-avatar" style="background: ${player.avatar.bg}">
                            ${player.avatar.emoji}
                        </div>
                        <div class="player-info-text">
                            <div class="player-name">${player.name}</div>
                            <div class="player-stats">
                                <span class="player-time">${timeText}</span>
                                <span class="player-winrate ${winRateClass}">${player.winRate}% W</span>
                            </div>
                        </div>
                    `;

    return div;
  }

  addRandomPlayer() {
    const names = [
      "Crypto King",
      "Moon Walker",
      "Diamond Hands",
      "Whale Hunter",
      "Degen Trader",
      "Bull Master",
      "Bear Slayer",
      "Profit Ninja",
    ];

    const avatars = [
      { emoji: "🚀", bg: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)" },
      { emoji: "💎", bg: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)" },
      { emoji: "🐋", bg: "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)" },
      { emoji: "🔥", bg: "linear-gradient(135deg, #fa709a 0%, #fee140 100%)" },
    ];

    const name = names[Math.floor(Math.random() * names.length)];
    const avatar = avatars[Math.floor(Math.random() * avatars.length)];
    const winRate = Math.floor(Math.random() * 60) + 30;

    // Remove oldest player
    if (this.players.length >= 10) {
      this.players.shift();
    }

    // Add new player
    this.players.push({
      id: Date.now(),
      name: name,
      avatar: avatar,
      winRate: winRate,
      joinTime: new Date(),
    });

    // Re-render
    this.renderPlayers();

    // Duplicate for scroll
    setTimeout(() => {
      const children = Array.from(this.leaderboardContent.children);
      children.forEach((child) => {
        const clone = child.cloneNode(true);
        this.leaderboardContent.appendChild(clone);
      });
    }, 100);
  }
}

// Initialize game when DOM is loaded
document.addEventListener("DOMContentLoaded", () => {
  new TradingGame();
});

// Prevent scrolling and zooming on mobile
document.addEventListener(
  "touchmove",
  (e) => {
    e.preventDefault();
  },
  { passive: false }
);

document.addEventListener("gesturestart", (e) => {
  e.preventDefault();
});

    </script>
</body>
</html>